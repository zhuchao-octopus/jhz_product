<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">
<title>欢迎页面-X-admin2.0</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<!-- <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" /> -->
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<link rel="stylesheet" href="../css/font.css">
<link rel="stylesheet" href="../css/xadmin.css">
<link rel="stylesheet" href="../lib/layui/css/layui.css">
 <script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript" src="../js/cookie_util.js"></script>
<script type="text/javascript" src="../js/self.js"></script>
<script type="text/javascript" src="../js/xadmin.js"></script>
<script type="text/javascript" src="./js/websocket.js"></script>
<script type="text/javascript" src="../jsplug/echarts.min.js"></script>
<script type="text/javascript" src="../lib/layui/layui.js" charset="utf-8"></script>
</head>
<style>
         /*  .table1{
            font-family: "Microsoft Himalaya";
            font-size:20px;
            border-bottom:1px dashed #CCCCCC;
            color: #255e95;
        }  */
      
        /* btgn{
            font-family: "Microsoft YaHei UI";
            font-size: 20px;
            color: #255e95;
            background-color: #e9faff;
            text-align: center;
        }  */
    </style>
<body>
<div>
		<span class="layui-breadcrumb"> <a href="">项目管理</a> <a href="">工作台</a><a class="layui-btn layui-btn-small"
						style="line-height: 1.6em; margin-top: 3px; float: right"
						href="javascript:window.location.reload()" title="刷新"> <i
						class="layui-icon" style="line-height: 30px">&#xe666;</i>
			    </a>
			<!--<a>
          <cite>导航元素</cite></a>-->
		</span>
		
		<!-- <ul class="layui-nav"  style="text-align: right">
				<li class="layui-nav-item">
				<a class="layui-btn layui-btn-small"
						style="line-height: 1.6em; margin-top: 3px; float: right"
						href="javascript:window.location.reload()" title="刷新"> <i
						class="layui-icon" style="line-height: 30px">&#xe666;</i>
			    </a>
			    </li>
		</ul> -->
	</div>
	<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
		  <ul class="layui-tab-title" id="" style="font-size:20px;">
		  	<li class="layui-this">状态信息</li> <li>任务表</li><li>聊天信息</li>
		  </ul>
		  <div class="layui-tab-content" style=" height: 300px;width: 1100px;">
		  	<div class="layui-tab-item layui-show">
		  	<span></span>
		  	<div class="panel-body"  >
  				<table id="gzb" lay-filter="parse-table-demo" width="60%" border="0" cellspacing="1" cellpadding="1">
    					<tr style="border-bottom:1px dashed #CCCCCC; color: #255e95;height:50px">
      						<td class="table1" style="font-size:20px;">姓名：<span id="userName" style="font-size:20px; color: black;"></span></td>
      						<td class="table1" style="font-size:20px;"></td>
    					</tr>
    					<tr style="border-bottom:1px dashed #CCCCCC; color: #255e95;height:50px">
      						<td class="table1" style="font-size:20px;">职务：</td>
      						<td class="table1" style="font-size:20px;"></td>
    					</tr>
    					<tr style="border-bottom:1px dashed #CCCCCC; color: #255e95;height:50px">
      						<td class="table1" style="font-size:20px;">技能：</td>
      						<td class="table1" style="font-size:20px;"></td>
    					</tr>
    					<tr style="border-bottom:1px dashed #CCCCCC; color: #255e95;height:50px">
      						<td class="table1" style="font-size:20px;">我的项目：
      						<span id="myxm" style="font-size:20px; color: black;"></span></td>
      						<td class="table1" style="font-size:20px;">
      							<button class="layui-btn layui-btn-warm" onclick="x_admin_show('我的项目','./myproject_list.html',750,600)">详情</button>
      						</td>
    					</tr>
    					<tr style="border-bottom:1px dashed #CCCCCC; color: #255e95;height:50px;">
      						<td class="table1" style="font-size:20px;">我的任务：<span id="MyTasks" style="font-size:20px; color: black;"></span></td>
      						<td class="table1" style="font-size:20px;">
      							<button class="layui-btn layui-btn-warm" onclick="x_admin_show('我的任务','./mytasks_list.html',750,600)">详情</button>
      						</td>
    					</tr>
    					<tr style="border-bottom:1px dashed #CCCCCC; color: #255e95;height:50px;">
      						<td style="font-size:20px;">完成的任务：</td>
      						<td style="font-size:20px;">
      							<button class="layui-btn layui-btn-warm" onclick="x_admin_show('完成的任务','./myTasksCompleteState_list.html?tasks_state=1',750,600)">详情</button>
      						</td>
    					</tr>
    					<tr style="border-bottom:1px dashed #CCCCCC; color: #255e95;height:50px;">
      						<td style="font-size:20px;">进行的任务：</td>
      						<td style="font-size:20px;">
      							<button class="layui-btn layui-btn-warm" onclick="x_admin_show('进行的任务','./myTasksState_list.html?jhz_submission=0',750,600)">详情</button>
      						</td>
    					</tr>
    					<tr style="border-bottom:1px dashed #CCCCCC; color: #255e95;height:50px;">
      						<td style="font-size:20px;">我的积分：<span id="jhz_integral" style="font-size:20px; color: black;"></span></td>
      						<td style="font-size:20px;">
      							<button class="layui-btn layui-btn-warm" onclick="x_admin_show('积分详情','./myintegral_list.html',750,600)">详情</button>
      						</td>
    					</tr>
				</table>
				<span></span><br/>
				<div>
    				<!-- <button class="layui-btn layui-btn-primary">原始按钮</button>
    				<button class="layui-btn">默认按钮</button> -->
    				<button class="layui-btn layui-btn-normal" onclick="x_admin_show('项目列表','./projectReceive.html',750,600)">领取项目</button>
    				
  				</div>
				</div>
		  	</div>
		  <div class="layui-tab-item">
			<table id="demo" lay-filter="demo" class="mac-table"></table>
		 </div>
		 <div class="layui-tab-item">
     		<button onclick="closeWebSocket()">关闭WebSocket连接</button>
     		<hr/>
     		<div id="message" style="border-bottom:1px dashed #CCCCCC; color: #255e95;height:500px;">
     		
     		</div>
     		<input id="text" type="text"/><button onclick="send()">发送消息</button>
		 </div>
		</div>
	</div>	
<script>
var userId=loginUser.userId;
console.log(userId);
var myxm=loadMyXM(userId);
var MyTasks=loadMyTasks(userId)
console.log(myxm);
var userName=loginUser.realName;
var jhz_integral=loadMyIntegra(userId)
console.log(jhz_integral);
$("#MyTasks").empty().append(MyTasks);
$("#jhz_integral").empty().append(jhz_integral);
$("#userName").empty().append(userName);
$("#myxm").empty().append(myxm);
layui.use('table', function(){
	  var table = layui.table;
	  table.render({
	    elem: '#demo'
	    ,height: 470
	    //,width:1500
	    ,cellMinWidth: 80
	    ,url: getContextPath()+'/board/loadTasks.do' //数据接口
	    
	    ,page: true //开启分页
	    ,cols: [[ //表头
	      {type: 'checkbox'}    
	      ,{field: 'jhz_tasksName', title: '任务名', width:90, sort: true}
	      ,{field: 'jhz_projectName', title: '项目名', width:90}
	      ,{field: 'jhz_tasksDescribe', title: '任务说明', width:100, sort: true}
	      ,{field: 'jhz_tasksTime', title: '完成时间', width:90, sort: true}
	      ,{field: 'jhz_tasksIntegral', title: '任务积分', width:90,sort: true} 
	      ,{field: 'jhz_innovate', title: '技术创新', width: 90}
	      ,{field: 'jhz_peple', title: '负责人', width:90, sort: true}
	      ,{field: 'jhz_efficiency', title: '效评', width:90}
	      ,{field: 'tasks_state', title: '是否完成', width:90,templet:function(d){
	    	  if(d.jhz_state=="1"){
 	    		  return "已完成";
 	    	  }else{
 	    		  return "未完成";
 	    	  }
 	      }} 
	      //,{field:'',title:"操作",width:240, align:'center', templet:"#barDemo"}

	    ]]
	    ,id:"projectId"
	    ,done:function(){
	       
	        if(!contains('bomb_edit',per_arr)){
	        	$("#mac-button").css("display","none");

	        	//console.log($(".layui-table"));
	        	$(".layui-table .permission").css("display","none");
	        }
	    	//$(".layui-table .permission").css("display","none");
	    }
	  });
	  var  active = {
            getId:function (data) {//获取选中行的主键
                var idArr = [];
                for(var i=0; i<data.length; i++){
                    console.log(data[i].id)
                    idArr.push(data[i].id)
                }
                console.log(idArr);
                return idArr;
            }
        	,moreDelete:function(){ //批量删除
            var checkStatus = table.checkStatus("demoId")
              ,data = checkStatus.data;
  		    console.log(data);
              var arr=active.getId(data);
              if(arr.length==0){
              	layer.msg('未选中任何数据');
              	return;
              }
              var idstring=arr.join(",");
        	layer.confirm('确定要删除吗？', {
        	  btn: ['确定','取消'] //按钮
        	}, function(){
        		layer.msg('确定', {icon: 1});
        		$.ajax({
              	  type:"get",
              	  url:"/jhz_mtvCms/user/deleteMacById.do",
              	  data:{"idstring":idstring},
              	  dataType:"json",
              	  success:function(result){
              		  if(result.status==1){
                            layer.msg(result.msg,{icon:1,time:1000});
                            window.location.reload();
              		  }else{
              			  layer.msg(result.msg,{icon:1,time:1000});
              		  }
              	  },
              	  error:function(){
              		  layer.msg("error:请检查代码",{icon:1,time:1000});
              	  }
                })
	                	 
	                 
        	}, function(){
        		layer.msg('取消', {icon: 2});
        	   
        	});
          }  
       ,search:function(){
    	  
    	  /*  var jhz_projectNumber=$("#jhz_projectNumber").val().trim();
    	 var jhz_projectName=$("#jhz_projectName").val().trim();
    	var jhz_respoName=$("#jhz_respoName").val().trim();
    	var jhz_state=$("#jhz_state").val().trim();
    	var jhz_startName=$("#jhz_startName").val().trim(); */
    	  // var storeState=$("#storeState option:selected").val();
    	   
    	   //执行重载
 	    	      table.reload('projectId', {
 	    	        page: {
 	    	          curr: 1 //重新从第 1 页开始
 	    	        }
 	    	        ,where: {
 	    	        	/* "jhz_projectNumber":jhz_projectNumber,
 	    	        	"jhz_projectName":jhz_projectName,
 	    	        	"jhz_respoName":jhz_respoName,
 	    	        	"jhz_state":jhz_state,
 	    	        	"jhz_startName":jhz_startName */
                    //"storeState":storeState
 	    	        }
 	    	      });
       }
        };
	  
	  $('.x-body .layui-btn').on('click', function () {
        var type = $(this).data('type');
        active[type] ? active[type].call(this) : '';
    });
	  table.on('tool(demo)',
				function(obj) {
					var data = obj.data; //获得当前行数据
					console.log("当前行的数据为:" + data);
					var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
					var tr = obj.tr; //获得当前行 tr 的DOM对象

					if (layEvent === 'delete') { //删除
						layer.confirm('真的删除行么', function(index) {
							$.ajax({
								type : "get",
								url : getContextPath()+'/board/deleteTasks.do',
								data : {
									"tid" : data.tid
									//"jhz_state" : data.jhz_state
								},
								dataType : "json",
								success : function(result) {
									if (result.state == 0) {
										layer.msg("删除成功!");
										obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
										layer.close(index);
									} else {
										layer.msg(result.msg);
									}
								},
								error : function(result) {
									layer.msg("error")
								}
							})

						});
					} else if (layEvent === 'update') { //编辑
						var tasks = JSON.stringify(data)
						
						if (!window.localStorage) {
							layer.msg("浏览器不支持localstorage");
							return false;
						} else {
							var storage = window.localStorage;
							storage.setItem("tasks",tasks);
						}
						x_admin_show("任务编辑","./tasks_update.html", 600, 500);
						obj.update({
							username : '123',
							title : 'xxx'
						});
					}
					
				});
	  
	});
</script>
</body>
</html>