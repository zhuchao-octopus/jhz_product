<!DOCTYPE html>
<html>
  
  <head>
    <meta charset="UTF-8">
    <title>欢迎页面-X-admin2.0</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/xadmin.css">
    <script type="text/javascript" src="./js/jquery.min.js"></script>
    <script type="text/javascript" src="./js/cookie_util.js"></script>
    <script type="text/javascript" src="./js/self.js"></script>
    <script type="text/javascript" src="./lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="./js/xadmin.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  
  <body>
    <div class="x-body">
        <form class="layui-form">
          <div class="layui-form-item">
              <label for="process" class="layui-form-label">
                  产品名
              </label>
              <div class="layui-input-inline">
                  <select id="process" name="process"  lay-search>
                  </select>
              </div>
            
          </div>
          <div class="layui-form-item">
              <label for="porder" class="layui-form-label">
                  订单批次
              </label>
              <div class="layui-input-inline">
                  <select   id="porder" name="porder"  lay-search>
                  </select>
              </div>
          </div>
          <div class="layui-form-item">
              <label for="batch" class="layui-form-label">
                  生产批次
              </label>
             <div class="layui-input-inline">
                  <select   id="batch" name="batch"   lay-search>
                  </select>
              </div>
          </div>
          <div class="layui-form-item">
              <label for="workOrder" class="layui-form-label">
                 计划单号
              </label>
              <div class="layui-input-inline">
                  <select   id="projectNumber"  name="projectNumber"   lay-search>
                  </select>
              </div>
          </div>
          <div class="layui-form-item">
              <label for="customer" class="layui-form-label">
                  产品类型
              </label>
              <div class="layui-input-inline">
                  <select   id="modelCode" name="modelCode"    lay-search>
                  </select>
              </div>
          </div>
           <div class="layui-form-item">
              <label for="licenseTag" class="layui-form-label">
                  牌照方
              </label>
              <div class="layui-input-inline">
                  <select id="licenseTag" name="licenseTag"  lay-search>
                  </select>
              </div>
          </div>
          <div class="layui-form-item">
              <label for="region" class="layui-form-label">
                  出货地区
              </label>
              <div class="layui-input-inline">
                  <select   id="region" name="region"  lay-search>
                  </select>
              </div>
          </div>
          <div class="layui-form-item">
              <label for="cid" class="layui-form-label">
                  客户
              </label>
              <div class="layui-input-inline">
                  <select   id="cid" name="cid"  lay-search>
                  </select>
              </div>
          </div>
          <div class="layui-form-item">
              <label for="cid" class="layui-form-label">
                 出货时间段
              </label>
              <div class="layui-input-inline">
                  <input type="text"  name="deliver"  autocomplete="off" class="layui-input" id='exportime'>
              </div>
          </div>
          <div class="layui-form-item">
              <label for="L_username" class="layui-form-label">
                  SN开始
              </label>
              <div class="layui-input-inline">
                  <input type="text" id="startSn" name="startSn"  autocomplete="off" class="layui-input">
              </div>
              <label for="L_username" class="layui-form-label">
                  SN结束
              </label>
              <div class="layui-input-inline">
                  <input type="text" id="endSn" name="endSn"  autocomplete="off" class="layui-input">
              </div>
          </div>
          <div class="layui-form-item">
              <label for="L_username" class="layui-form-label">
                  箱号文档
              </label>
              <input type="file" value="选择文件" id="upload" style="display:none;"  onchange="return fileUpload_onselect()"/>
              <input type="button" value="选择文档" id="import"   style="background-color: #009688;width: 64px;height:38px"/>
          </div>
          
          <div class="layui-form-item" >
             <label for="L_username" class="layui-form-label">
                 <!--  箱号文档 -->
              </label>
               <div class="layui-input-inline" >
                  <textarea class="layui-textarea"  id="boxnumFile"  name="boxnumString" disabled="disabled"></textarea>
              </div>
          </div>

          
          <div class="layui-form-item">
              <label for="L_repass" class="layui-form-label">
              </label>
              <button type="button" class="layui-btn"  lay-filter="export"  lay-submit="">导出</button>
          </div>
      </form>
    </div>
    <script>
    
    $("#import").click(function(){
        $("#upload").click();//代码去触发点击
    })
    
    /**
     * 点击[选择文件]按钮时触发的事件
     */
    function fileUpload_onclick(){
		alert("HAHA");
    }
    /**
     * 选中文件后触发的事件
     * 直接前台解析txt文件。使用的是FileReader对象
     */
    function fileUpload_onselect(){
        console.log("onselect");
        var path = $("#upload").val();//文件路径
        console.log(path);	//C:\fakepath\testfile.txt	
        var selectedFile = document.getElementById("upload").files[0];
		console.log(selectedFile); //File(20) {name: "testfile.txt", lastModified: 1531300104720, lastModifiedDate: Wed Jul 11 2018 17:08:24 GMT+0800 (中国标准时间), webkitRelativePath: "", size: 20, …}
		console.log(selectedFile.src);// undefined
		console.log(selectedFile.type);// text/plain
		var name = selectedFile.name;//读取选中文件的文件名
        var size = selectedFile.size;//读取选中文件的大小
        console.log("wenjianming:"+name+"daxiao:"+size);//wenjianming:testfile.txtdaxiao:20
        var reader = new FileReader();//这是核心！！读取操作都是由它完成的
        reader.readAsText(selectedFile);
       //readAsText(file,[encoding]):将文件读取为文本，encoding缺省为UTF-8   readAsText(selectedFile,'UTF-8')
        reader.onload = function(oFREvent){//读取完毕从中取值
        var pointsTxt = oFREvent.target.result;
        var arr=pointsTxt.split('\r');
       /*  var str="";
        for(var i=0;i<arr.length;i++){
        	str+=arr[i];
        } */
        
        $("#boxnumFile").text(arr);
        }
    }
    
    
    
    
    
    
    var productOption=loadProductOption();
    $("#process").empty().append("<option value=''>--请选择产品名--</option>"+productOption);
    var str="modelCode";
    var dataOption=findOptionData(str);
    $("#modelCode").empty().append("<option value=''>--请选择产品类型--</option>"+dataOption);
    str="porder";
    dataOption=findOptionData(str)
    $("#porder").empty().append("<option value=''>--请选择订单批次--</option>"+dataOption);
    $("#cid").empty().append("<option value=''>--请选择客户--</option>"+loadAllCust());
    $("#batch").empty().append("<option value=''>--请选择批次--</option>");
    $("#projectNumber").empty().append("<option value=''>--请选择计划单号--</option>");
    $("#licenseTag").empty().append("<option value=''>--请选择牌照方--</option>");
    $("#region").empty().append("<option value=''>--请选择地区--</option>");
    $.ajax({
    	type:"get",
    	async:false,
    	url:"list/distinctData.do",
    	dataType:"json",
    	success:function(res){
    		if(res.state==0){
    			for(var i=0;i<res.data.length;i++){
    				console.log(res.data);
    				$("#batch").append("<option value='"+res.data[i]+"'>"+res.data[i]+"</option>");
    			}
    		    for(var i=0;i<res.data1.length;i++){
    				$("#projectNumber").append("<option value='"+res.data1[i]+"'>"+res.data1[i]+"</option>");
    			}
    			for(var i=0;i<res.data2.length;i++){
    				$("#licenseTag").append("<option value='"+res.data2[i]+"'>"+res.data2[i]+"</option>");
    			}
    			for(var i=0;i<res.data3.length;i++){
    				$("#region").append("<option value='"+res.data3[i]+"'>"+res.data3[i]+"</option>");
    			}
    		}
    		 return false;
    	},
    	errro:function(res){
    		
    	}
    	
    });
        layui.use(['form','layer','laydate'], function(){
            $ = layui.jquery;
          var form = layui.form
          ,laydate=layui.laydate
          ,layer = layui.layer
          
        //执行一个laydate实例
			laydate.render({
				elem : '#exportime', //指定元素
				range:"~"
			});
          
        //监听提交
          form.on('submit(export)', function(data){
            var param=data.field;
            console.log(param);
            $.ajax({
            	type:"get",
            	data:param,
            	url:"list/exportCode.do",
            	dataType:"json",
            	success:function(res){
            		if(res.state==0){
            			window.open(res.data);
            			layer.msg("导出成功!");
            		}else{
            			layer.alert(res.msg, {icon: 6});
            		}
            	}
            })
            
            return false;
          });
       
     });
          
   
    </script>
    <script>var _hmt = _hmt || []; (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?b393d153aeb26b46e9431fabaf0f6190";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();</script>
  </body>

</html>